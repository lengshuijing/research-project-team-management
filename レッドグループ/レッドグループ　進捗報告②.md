\documentclass[11pt, oneside]{article}   	
\usepackage{geometry}                		
\geometry{letterpaper}                   		
%\geometry{landscape}                		
%\usepackage[parfill]{parskip}    		
\usepackage{graphicx}				
\usepackage{amssymb}

\title{マルチエージェントAI開発プロジェクト文書}
\author{開発チーム}

\begin{document}
\maketitle

\end{document}

マルチエージェントAI開発 - レッドグループ

第5週

パート1：プロジェクト概要

目的
このプロジェクトは、単一のゼロショットAIエージェントのパフォーマンスを改善する、協調的なAIエージェントシステムの開発を目指しています。私たちのアプローチは、複数の「惑星」を作成し、各惑星に構造化された方法で答えを議論し改善できる複数のエージェントを配置することです。エージェントをこのように組織化することで、集団的推論が個別の推論よりもベンチマーク問題でより優れているかどうかを探ることができます。

アプローチと方法論
1. マルチエージェント、マルチプラネットシミュレーション：各「惑星」は、複数のエージェントが解決策を交換し結果について議論することで、協力して問題を解決するシミュレーション環境です。
2. 議論メカニズム：更新された議論メカニズムには、惑星内と惑星間の2つのレベルがあります。各惑星内で、エージェントは反復的な議論ラウンドに参加し、フィードバックに基づいて回答を改善し、回答が類似度閾値を超えて一致した時点で収束を達成します。惑星のアグリゲーターは合意された回答を生成し、代表者が惑星間委員会に提出します。この委員会は全惑星からの合意回答を収集し、多数決投票により最終回答を決定します。
3. 比較ベンチマーク：成功を測定するため、マルチエージェントソリューションの精度をゼロショットエージェントと比較します。

次のステップ
来週は以下を計画しています：
- ユーザーが各実験のLLMモデルを選択できるようにする
- ユーザーが各エージェントの固有のキャラクタープロファイルを定義できるようにする
- スワームからAutogenフレームワークへの移行を進めています。これにより、各エージェントの動作と新しい通信トポロジーをより柔軟に定義できます。以下は、エージェントの動作を定義しマルチエージェント議論を開始する例です：

```python
agent1 = ConversableAgent(
    "agent1",
    system_message="あなたは数学の専門家です。",
    llm_config={"model": "llama3.1", "api_type": "ollama"},
    human_input_mode="NEVER",
)

result = Groupchat([agent1, agent2], message="25の平方根は何ですか？")
```
会話の要約：
	•	エージェント1（エージェント2へ）：「25の平方根は何ですか？」
	•	エージェント2（エージェント1へ）：「25の平方根は5です。√25 = 5です。なぜなら5 × 5 = 25だからです。」
	•	エージェント1（エージェント2へ）：「正解です！さらに、25の平方根は-5にもなり得ます。なぜなら(-5) × (-5) = 25だからです。したがって、√25 = ±5です。」

- また、PromptBreederにインスピレーションを受けた進化的プロンプト生成にも取り組んでいます。


---

パート2：コード概要

このセクションでは、プロジェクトの目的を達成するための各モジュールの役割に焦点を当てたコード構造の概要を提供します。

1. 環境設定

- APIとライブラリのインポート
    - スクリプトは必要なライブラリ（`openai`、`dotenv`（環境変数用）、`sklearn`（類似度計算用））をインポートします。
- 環境変数の設定
    - 安全なAPIアクセスを確保するため、`.env`からOpenAI APIキーを読み込みます。

2. ユーザー入力

プログラムは、惑星の数、惑星ごとのエージェント数、最大議論ラウンド数、全惑星が参加するか一部がランダムに選ばれるかなど、シミュレーション設定のユーザー入力を収集します。

主な入力プロンプトには以下が含まれます：
- `num_planets`：シミュレーションに参加する惑星の数を指定します。
- `agent_number`：惑星ごとのエージェント数を決定し、惑星内協力の規模を定義します。
- `max_rounds`：エージェントが解決策に収束するまでに許可される最大議論ラウンド数を設定します。
- `convergence_threshold`：エージェントの応答を収束したとみなす類似度閾値を定義します。


3. クラス定義

惑星クラス

シミュレーションにおける個々の惑星を表し、そのエージェント、議論、合意形成を管理する責任があります。主な属性には以下が含まれます：
- プロンプトジェネレーター：エージェントが解決すべき構造化された問題文を準備します。
- ハブ：惑星内の議論プロセスを管理し、エージェント間の相互作用を調整し、収束を監視します。
- エージェント：協力して解決策を議論し改善する知的エージェントのグループです。
- アグリゲーター：エージェントの応答を単一の合意回答に統合します。
- 代表者：惑星間の意思決定において惑星を代表し、合意回答を惑星間委員会に提出します。

ハブクラス

エージェント間の調整、応答の改善、収束チェックを含む、惑星内の議論を処理します。主な機能には以下が含まれます：
- 議論管理：
	• エージェントは反復的に応答を交換し、自身の回答を振り返り、他者からのフィードバックを統合します。
	• 議論は収束（応答が類似度閾値を超えて一致）するか、最大ラウンド数に達するまで続きます。
- 類似度計算：
	• より堅牢な比較を提供するため、BERTエンベディングを使用した意味的類似度を計算します。

惑星間委員会クラス

惑星が合意回答を提出する際の惑星間の意思決定を促進します。以下を含みます：
- 最高議長：代表者の応答を分析し、多数決で合意が得られた場合に最終回答を決定する特別なエージェントです。
- 多数決投票：
	• 代表者が合意回答を提出し、集計されます。
	• 単一の回答に過半数の支持がある場合、それが最終決定となります。
	• 過半数が得られない場合、全惑星で2回目の議論が開始されます。

このクラスは惑星間の意思決定の堅牢性を向上させるために新たに導入されました。

4.メイン実行

更新されたメインループは、以下を含む全シミュレーションプロセスを統括します：
- 問題の配布：
	• 問題はランダムに選ばれた惑星または全惑星に配布されます（ユーザーの選択に基づく）。
	• 各惑星は、プロンプトジェネレーターに導かれて惑星内の議論を開始します。
- 惑星内議論：
	• 各惑星のエージェントは、ハブによって管理される解決策に収束するまで議論します。
	• 収束後、惑星のアグリゲーターが合意回答を生成し、代表者が提出します。
- 惑星間意思決定：
	• 惑星間委員会は代表者からの合意回答を収集します。
	• 多数決投票で最終回答を決定します。合意が得られない場合、共有された洞察を通じて収束を促す2回目の議論が開始されます。
- 結果とベンチマーク：
	• 惑星内および惑星間プロセスの精度と収束統計が計算されます。
	• 結果は更なる分析のために保存されます。


---

パート3：コンソール出力

以下は実行時の典型的なコンソール出力を示すスクリーンショットです：

OpenAI APIキーが見つかりました！
OpenAI設定 > プロジェクト > 制限でAPIキーを設定することを忘れないでください
提供されたOpenAI APIキーは有効です ✅

惑星の数を入力してください：3
入力を全惑星のプロンプトジェネレーターに送信しますか？（Y/N）：Y
惑星ごとのエージェント数を入力してください（エージェントのモデルは'gpt-4o-mini-2024-07-18'です）：3
最大議論ラウンド数を入力してください：10
収束閾値を入力してください（0から1の間）：0.8
実行したいベンチマーク質問の数を入力してください：2
比較実験を実行しますか？（単一エージェントのゼロショットと実行・比較）（y/n）：Y

================================================================================
質問 1:
================================================================================
--------------------------------------------------------------------------------
質問1に参加する惑星: 惑星1、惑星2、惑星3
--------------------------------------------------------------------------------

********************************************************************************
質問1の惑星1を処理中
********************************************************************************
********************************************************************************
質問1の惑星2を処理中
********************************************************************************
********************************************************************************
質問1の惑星3を処理中
********************************************************************************

------------------------------------------------------------
惑星3 - 議論ラウンド1
------------------------------------------------------------
    [ラウンド1] 惑星3 エージェント1を処理中...
    [ラウンド1] 惑星3 エージェント2を処理中...
    [ラウンド1] 惑星3 エージェント3を処理中...
惑星3 ラウンド1の平均類似度: 0.97
--- 惑星3の応答は平均類似度0.97で収束しました ---


============================================================
惑星3の集約された回答：
============================================================
全エージェントの計算と確認から得られた合意回答は、ジャネットが農民市場で卵を売って1日に合計18ドルを稼ぐということです。

18
============================================================

[以下、同様の形式で出力が続きます...]

================================================================================
マルチプラネットベンチマーク概要
================================================================================
総質問数: 2
総試行回数: 8
経過時間: 137.66秒
正解数: 4
精度: 50.00%

================================================================================
ゼロショットエージェントベンチマーク概要
================================================================================
総質問数: 2
総試行回数: 2
経過時間: 3.38秒
正解数: 2
精度: 100.00%

================================================================================
比較概要
================================================================================
マルチエージェントシステム精度: 50.00%
ゼロショットエージェント精度: 100.00%
ゼロショットエージェントがマルチエージェントシステムを上回りました。

プロセスは終了コード0で完了しました
